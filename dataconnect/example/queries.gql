# Queries for wedding gifts and blessings app

# List all public blessings with their reactions
query ListPublicBlessings @auth(level: PUBLIC, insecureReason: "Anyone can see public blessings.") {
  blessings(where: { isPublic: { eq: true } }, orderBy: { createdAt: DESC }) {
    id
    message
    mediaUrl
    mediaType
    createdAt
    user {
      id
      username
    }
    reactions: reactions_on_blessing {
      emoji
      user {
        id
        username
      }
    }
  }
}

# List all blessings for authenticated user (including private ones they created)
query ListUserBlessings @auth(level: USER) {
  user(key: { id_expr: "auth.uid" }) {
    id
    username
    blessings: blessings_on_user(orderBy: { createdAt: DESC }) {
      id
      message
      mediaUrl
      mediaType
      isPublic
      createdAt
      reactions: reactions_on_blessing {
        emoji
        user {
          id
          username
        }
      }
    }
  }
}

# Get a specific blessing with all its reactions
query GetBlessing($id: UUID!) @auth(level: PUBLIC, insecureReason: "Public blessings can be viewed by anyone.") {
  blessing(id: $id) {
    id
    message
    mediaUrl
    mediaType
    isPublic
    createdAt
    user {
      id
      username
    }
    reactions: reactions_on_blessing {
      emoji
      createdAt
      user {
        id
        username
      }
    }
  }
}

# Get reaction counts for a blessing (grouped by emoji)
query GetBlessingReactions($blessingId: UUID!) @auth(level: PUBLIC, insecureReason: "Anyone can see reaction counts.") {
  blessing(id: $blessingId) {
    id
    reactions: reactions_on_blessing {
      emoji
      user {
        id
        username
      }
    }
  }
}
